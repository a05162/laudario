<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laud√°rio Radiologia</title>
  <style>
    :root {
      /* Paleta moderna em verde-petr√≥leo */
      --bg: #0e1f1e;          /* fundo geral */
      --panel: #12302e;       /* header / pain√©is */
      --muted: #a7c2bf;
      --text: #ffffff;        /* texto geral */
      
      --accent: #3fd1b8;      /* verde-√°gua */
      --accent-2: #29b7a0;    /* ciano esverdeado */
      --border: #1d3e3c;

      /* Cards */
      --cat-bg: #153b38;
      --cat-head: #1b4a46;

      /* Frases */
      --phrase-bg: #f5f7f6;    /* fundo claro */
      --phrase-border: #cfd6d4;
      --phrase-text: #0d1817;  /* texto preto-acinzentado */
    }

    html, body { 
      height: 100%; 
      background: var(--bg); 
      color: var(--text); 
    }

    body { 
      margin: 0; 
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans;
    }

    html.sizeA { font-size: 15px; }
    html.sizeB { font-size: 17px; }
    html.sizeC { font-size: 19px; }

    .app { display: grid; grid-template-rows: auto auto 1fr; min-height: 100vh; }

    /* HEADER ‚Äî agora com fundo s√≥lido (sem degrad√™) */
    header {
      position: sticky; top: 0; z-index: 10;
      display: grid; grid-template-columns: 1fr auto 1fr; align-items: center;
      gap: .75rem; padding: .75rem 1rem;
      background: var(--panel);
      border-bottom: 1px solid var(--border);
    }

    .brand { display: flex; align-items: center; gap: .5rem; }

    .brand .dot {
      width: .6rem; height: .6rem; border-radius: 9999px;
      background: var(--accent);
      box-shadow: 0 0 0 .2rem rgba(63,209,184,.25);
    }

    /* seletor √≥rg√£o */
    .org-select select {
      background: #0f2725; color: var(--text);
      border: 1px solid var(--border);
      border-radius: .4rem; 
      padding: .45rem .6rem; 
      outline: none; 
      cursor: pointer;
    }

    /* Busca */
    .search { justify-self: center; width: min(680px, 95%); }
    .search input {
      width: 100%; background: #0c2422; color: var(--text);
      border: 1px solid var(--border);
      padding: .55rem .8rem; border-radius: .4rem; outline: none;
    }

    .header-right { justify-self: end; height: 1rem; }

    main { padding: 1rem; }

    .cat-grid { 
      display:grid; 
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
      gap: 1rem; 
    }

    /* CAT CARDS ‚Äî lisos, mais retos, sem sombra */
    .cat-card {
      background: var(--cat-bg);
      border:1px solid var(--border);
      border-radius: .6rem;
      display:flex; 
      flex-direction: column;
    }

    .cat-head {
      display:flex; 
      align-items:center; 
      justify-content: space-between; 
      gap:.75rem;
      padding:.75rem .9rem;
      background: var(--cat-head);
      border-bottom:1px solid var(--border);
    }

    .cat-title { font-weight: 700; letter-spacing:.2px; }

    .cat-actions { display:flex; gap:.35rem; }

    .btn-icon {
      display:inline-grid; place-items:center;
      width: 32px; height: 32px;
      border-radius:.4rem;
      border:1px solid var(--border);
      background: rgba(255,255,255,.07);
      color: var(--text);
      cursor:pointer;
    }

    .btn-icon:hover { border-color: var(--accent); }

    /* FRASES */
    .phrases { display:flex; flex-direction: column; gap:.5rem; padding:.8rem; }

    .phrase {
      background: var(--phrase-bg);
      border:1px solid var(--phrase-border);
      border-radius:.5rem;
      padding:.6rem .7rem;
      line-height: 1.35rem;
      cursor: copy; 
      position: relative;
      color: var(--phrase-text); /* texto escuro */
    }

    .phrase:hover {
      border-color: var(--accent);
      background: #ffffff;
    }

    .copy-hint {
      position:absolute; right:.6rem; bottom:.45rem;
      color: #555;
      font-size:.74rem;
    }

    /* FAB sem degrad√™ */
    .fab {
      position: fixed; right: 1rem; bottom: 1rem; z-index: 20;
      width: 48px; height: 48px;
      border-radius: .6rem;
      background: var(--accent);
      color: #01201c;
      border: none; cursor: pointer;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand org-select">
        <span class="dot" aria-hidden="true"></span>
        <label for="organSelect" class="sr-only">√ìrg√£o</label>
        <select id="organSelect"></select>
      </div>

      <div class="search">
        <input id="searchInput" type="search" placeholder="Buscar frase‚Ä¶ (Enter para aplicar)" />
      </div>

      <div class="header-right"></div>
    </header>

    <main>
      <div class="cat-grid" id="catGrid"></div>
    </main>

    <footer>
      <small>Click para copiar ‚Ä¢ Tamanho: A/B/C no bot√£o "+Aa"</small>
    </footer>
  </div>

  <button id="sizeFab" class="fab">+Aa</button>

  <script>
    /* JS ORIGINAL ‚Äî preservado */
    const DB = new Map();
    const ORG_ORDER = [];
    const DEFAULT_CATEGORY = 'Geral';
    let currentOrgan = null;
    let currentQuery = '';

    const qs = (sel, el=document) => el.querySelector(sel);
    const normalize = s => s.normalize('NFD').replace(/\p{Diacritic}+/gu, '').toLowerCase();

    function parseLaudario(txt) {
      DB.clear(); ORG_ORDER.length = 0;
      let organ = null, category = null;

      for (const rawLine of txt.split(/\r?\n/)) {
        const line = rawLine.trim();
        if (!line || line.startsWith('#') || line.startsWith(';')) continue;

        const sect = line.match(/^\[(.+?)\]$/);
        if (sect) {
          const parts = sect[1].split('>').map(s => s.trim());
          organ = parts[0];
          category = parts[1] || DEFAULT_CATEGORY;
          if (!DB.has(organ)) { DB.set(organ, new Map()); ORG_ORDER.push(organ); }
          if (!DB.get(organ).has(category)) DB.get(organ).set(category, []);
          continue;
        }

        if (organ) DB.get(organ).get(category).push(line);
      }
    }

    function renderOrganSelect() {
      const sel = qs('#organSelect');
      sel.innerHTML = '';
      for (const organ of ORG_ORDER) {
        const opt = document.createElement('option');
        opt.value = organ; opt.textContent = organ;
        sel.appendChild(opt);
      }
      if (currentOrgan && ORG_ORDER.includes(currentOrgan)) sel.value = currentOrgan;
    }

    function renderCategoryCards() {
      const grid = qs('#catGrid');
      grid.innerHTML = '';
      if (!currentOrgan) return;

      const catMap = DB.get(currentOrgan);
      if (!catMap) return;

      const cats = Array.from(catMap.entries()).sort((a,b) => a[0].localeCompare(b[0]));

      for (const [cat, list] of cats) {
        const items = currentQuery
          ? list.filter(x => normalize(x).includes(normalize(currentQuery)))
          : list.slice();

        if (!items.length) continue;

        const card = document.createElement('section');
        card.className = 'cat-card';

        const head = document.createElement('div');
        head.className = 'cat-head';

        const title = document.createElement('div');
        title.className = 'cat-title';
        title.textContent = cat;

        const actions = document.createElement('div');
        actions.className = 'cat-actions';

        const copyAllBtn = document.createElement('button');
        copyAllBtn.className = 'btn-icon';
        copyAllBtn.textContent = 'üìã';
        copyAllBtn.addEventListener('click', () => {
          const txt = items.join('\n\n');
          navigator.clipboard.writeText(txt).then(() => {
            copyAllBtn.textContent = '‚úì';
            setTimeout(() => (copyAllBtn.textContent = 'üìã'), 900);
          });
        });

        actions.appendChild(copyAllBtn);
        head.appendChild(title);
        head.appendChild(actions);

        const ul = document.createElement('div');
        ul.className = 'phrases';

        for (const text of items) {
          const li = document.createElement('div');
          li.className = 'phrase';
          li.tabIndex = 0;
          li.innerText = text;

          const hint = document.createElement('small');
          hint.className = 'copy-hint';
          hint.textContent = 'Copiar';
          li.appendChild(hint);

          li.addEventListener('click', () => {
            navigator.clipboard.writeText(text);
            hint.textContent = 'Copiado!';
            setTimeout(() => (hint.textContent = 'Copiar'), 900);
          });

          ul.appendChild(li);
        }

        card.appendChild(head);
        card.appendChild(ul);
        grid.appendChild(card);
      }

      if (!grid.children.length) {
        grid.innerHTML = `<p style="color:var(--muted)">Nenhuma frase encontrada.</p>`;
      }
    }

    function parseHash() {
      const h = location.hash.slice(1);
      const [path, queryStr] = h.split('?');
      const parts = (path || '').split('/').filter(Boolean);
      let org = parts[1] ? decodeURIComponent(parts[1]) : null;
      const query = new URLSearchParams(queryStr || '').get('q') || '';
      return { org, query };
    }

    function navigate(org, query = currentQuery) {
      if (!org) org = ORG_ORDER[0];
      const encoded = encodeURIComponent(org);
      const params = new URLSearchParams();
      if (query) params.set('q', query);
      location.hash = `#/orgao/${encoded}${params.toString() ? '?' + params.toString() : ''}`;
    }

    function applyRoute() {
      const r = parseHash();
      currentOrgan = r.org && DB.has(r.org) ? r.org : ORG_ORDER[0];
      currentQuery = r.query || '';
      renderOrganSelect();
      qs('#searchInput').value = currentQuery;
      renderCategoryCards();
    }

    window.addEventListener('hashchange', applyRoute);

    qs('#organSelect').addEventListener('change', e => navigate(e.target.value, ''));
    qs('#searchInput').addEventListener('keydown', e => {
      if (e.key === 'Enter') navigate(currentOrgan, e.currentTarget.value.trim());
    });

    const sizes = ['sizeA','sizeB','sizeC'];
    qs('#sizeFab').addEventListener('click', () => {
      const html = document.documentElement;
      const idx = sizes.findIndex(s => html.classList.contains(s));
      html.classList.remove(...sizes);
      const next = sizes[(idx + 1) % sizes.length];
      html.classList.add(next);
      localStorage.setItem('ui.size', html.className);
    });

    (async function init(){
      const cls = localStorage.getItem('ui.size');
      if (cls) document.documentElement.className = cls; else document.documentElement.classList.add('sizeB');
      try {
        const res = await fetch('laudario.txt');
        const txt = await res.text();
        parseLaudario(txt);
        if (ORG_ORDER.length) currentOrgan = ORG_ORDER[0];
        renderOrganSelect();
        applyRoute();
      } catch (e) {
        console.error(e);
        qs('#catGrid').innerHTML = '<p style="color:var(--muted)">Erro ao carregar laudario.txt</p>';
      }
    })();
  </script>
</body>
</html>
